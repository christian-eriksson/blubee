#!/bin/sh
print_help() {
    echo "usage: blubee [options] <command>\n"
    echo "command:"
    echo "\t* backup"
    echo "\noptions:"
    echo "\t-c <config-file>\tpath to custom config"
    echo "\t-h\t\t\tprint this help"
}

backup() {
    destination=$BACKUP_DESTINATION
    sources=$BACKUP_SOURCES
    if [ -f "$EXCLUDE" ]; then
        exclude=${EXCLUDE:+"-e $EXCLUDE"}
    else
       if [ -n "$EXCLUDE" ]; then
           echo "Exclude file '$EXCLUDE' does not exist. It will be ignored."
       fi
   fi
    ./backup.sh $exclude $sources $destination
}

config_file=./blubee.conf

while getopts ":c:h" option; do
    case "${option}" in
        c)
            config_file=$OPTARG;;
        h)
            print_help
            exit 1
            ;;
        :)
            echo "Missing argument for option '$OPTARG'"
            exit 1
            ;;
        ?)
            echo "Unrecognized option '$OPTARG'";;
    esac
done

. $config_file

command=$(echo $@ | cut -d' ' -f$OPTIND)
case "$command" in
    backup)
        backup;;
    *)
        print_help
        exit 1
        ;;
esac
